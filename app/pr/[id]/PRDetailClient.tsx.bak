'use client';

import { useState, useEffect, useRef } from 'react';
import { useParams } from 'next/navigation';
import Link from 'next/link';
import AddCommentButton from '@/app/components/AddCommentButton';
import CodeLine from '@/app/components/CodeLine';
import CoverageIndicator from '@/app/components/CoverageIndicator';

const basePath = process.env.NODE_ENV === 'production' ? '/code-review-prototype' : '';

export default function PRDetailClient() {
  const params = useParams();
  const prId = params.id as string;
  const [showGroupFiles, setShowGroupFiles] = useState(false);
  const [showGroupFiles2, setShowGroupFiles2] = useState(false);
  const [showGroupFiles3, setShowGroupFiles3] = useState(false);
  const [showFileChanges, setShowFileChanges] = useState(true);
  const [showFileChanges2, setShowFileChanges2] = useState(true);
  const [showFileChanges3, setShowFileChanges3] = useState(true);
  const [showReviewModal, setShowReviewModal] = useState(false);
  const [reviewType, setReviewType] = useState('comment');
  const [reviewComment, setReviewComment] = useState('');
  const [activeCommentLine, setActiveCommentLine] = useState<string | null>(null);
  const [newCommentText, setNewCommentText] = useState('');
  const commentInputRef = useRef<HTMLDivElement>(null);

  // File collapse states (true = expanded, false = collapsed)
  const [fileExpanded1, setFileExpanded1] = useState(true); // .github/workflows/ci.yml
  const [fileExpanded2, setFileExpanded2] = useState(true); // package.json
  const [fileExpanded3, setFileExpanded3] = useState(true); // package-lock.json
  const [fileExpanded4, setFileExpanded4] = useState(true); // src/services/auth.ts
  const [fileExpanded5, setFileExpanded5] = useState(true); // src/utils/refresh-token.ts
  const [fileExpanded6, setFileExpanded6] = useState(true); // migrations/add-user-preferences.sql

  // File checked states (true = marked as reviewed/checked)
  const [fileChecked1, setFileChecked1] = useState(false);
  const [fileChecked2, setFileChecked2] = useState(false);
  const [fileChecked3, setFileChecked3] = useState(false);
  const [fileChecked4, setFileChecked4] = useState(false);
  const [fileChecked5, setFileChecked5] = useState(false);
  const [fileChecked6, setFileChecked6] = useState(false);

  // Group review states (true = marked as reviewed)
  const [groupReviewed1, setGroupReviewed1] = useState(false);
  const [groupReviewed2, setGroupReviewed2] = useState(false);
  const [groupReviewed3, setGroupReviewed3] = useState(false);

  const handleLineClick = (lineId: string) => {
    setActiveCommentLine(lineId);
    setNewCommentText('');
    // Auto-focus will be handled by the input component
  };

  const handleCommentSubmit = (lineId: string) => {
    if (newCommentText.trim()) {
      // TODO: Submit comment to API
      console.log(`Submitting comment for line ${lineId}:`, newCommentText);
      setActiveCommentLine(null);
      setNewCommentText('');
    }
  };

  const handleCommentCancel = () => {
    setActiveCommentLine(null);
    setNewCommentText('');
  };

  // Click outside handler to cancel comment input
  useEffect(() => {
    const handleClickOutside = (event: MouseEvent) => {
      if (activeCommentLine && commentInputRef.current && !commentInputRef.current.contains(event.target as Node)) {
        handleCommentCancel();
      }
    };

    if (activeCommentLine) {
      document.addEventListener('mousedown', handleClickOutside);
    }

    return () => {
      document.removeEventListener('mousedown', handleClickOutside);
    };
  }, [activeCommentLine]);

  // Render new comment input row
  const renderNewCommentInput = (lineId: string) => {
    if (activeCommentLine !== lineId) return null;

    return (
      <tr className="inline-comment-row new-comment-row">
        <td className="line-number"></td>
        <td className="line-comment-toggle"></td>
        <td colSpan={2}>
          <div className="inline-comment-container" ref={commentInputRef}>
            <div className="inline-comment new-comment-input">
              <div className="inline-comment-avatar">F</div>
              <div className="inline-comment-content">
                <textarea
                  className="new-comment-textarea"
                  placeholder="Add a comment..."
                  value={newCommentText}
                  onChange={(e) => setNewCommentText(e.target.value)}
                  autoFocus
                  onKeyDown={(e) => {
                    if (e.key === 'Enter' && (e.metaKey || e.ctrlKey)) {
                      handleCommentSubmit(lineId);
                    } else if (e.key === 'Escape') {
                      handleCommentCancel();
                    }
                  }}
                />
                <button
                  className="submit-comment-btn"
                  onClick={() => handleCommentSubmit(lineId)}
                  disabled={!newCommentText.trim()}
                >
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                    <path d="M8 3l5 5-5 5V9H3V7h5V3z"/>
                  </svg>
                </button>
              </div>
            </div>
          </div>
        </td>
      </tr>
    );
  };

  // Mock PR data - in real app this would come from API
  const prData = {
    id: params.id,
    number: 35,
    title: 'SC-37654 Fix Mise',
    version: 2,
    description: 'This pull request addresses the critical issue found in the Mise configuration handler. The changes include refactoring the error handling logic, improving validation for configuration parameters, and adding comprehensive unit tests to ensure stability. Additional updates were made to the documentation to reflect the new behavior.',
    status: 'passed',
    author: 'sonarqubecloud',
    timestamp: '51 minutes ago'
  };

  const comments = [
    {
      id: 1,
      author: 'sonarqubecloud',
      avatar: 'bot',
      timestamp: '51 minutes ago',
      isBot: true,
      content: {
        type: 'quality-gate',
        status: 'passed',
        metrics: {
          newIssues: 0,
          acceptedIssues: 0,
          securityHotspots: 0,
          coverageOnNew: '0.0%',
          duplicationOnNew: '0.0%'
        }
      }
    },
    {
      id: 2,
      author: 'johndoe',
      avatar: 'JD',
      timestamp: '45 minutes ago',
      isBot: false,
      content: {
        type: 'comment',
        text: 'Great work on improving the error handling! The validation logic looks much cleaner now.'
      }
    },
    {
      id: 3,
      author: 'janesmit',
      avatar: 'JS',
      timestamp: '30 minutes ago',
      isBot: false,
      content: {
        type: 'comment',
        text: 'LGTM! The unit tests cover all the edge cases. Ready to merge once CI passes.'
      }
    }
  ];

  return (
    <div>
      {/* Top Navigation */}
      <header className="top-nav">
        <div className="top-nav-left">
          <button className="menu-toggle">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
              <path d="M3 5h14M3 10h14M3 15h14" stroke="currentColor" strokeWidth="2" strokeLinecap="round"/>
            </svg>
          </button>
          <div className="logo">
            <img src={`${basePath}/Sonar Qube Cloud.svg`} alt="SonarQube Cloud" width="157" height="36" />
          </div>
          <nav className="top-nav-center">
            <a href="#" className="nav-link">My Projects</a>
            <a href="#" className="nav-link">My Issues</a>
            <a href="#" className="nav-link nav-dropdown">
              My Portfolios
              <svg width="12" height="12" viewBox="0 0 12 12" fill="currentColor">
                <path d="M6 8L2 4h8L6 8z"/>
              </svg>
            </a>
            <a href="#" className="nav-link">Explore</a>
          </nav>
        </div>

        <div className="top-nav-right">
          <button className="icon-btn">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
              <circle cx="10" cy="10" r="7" stroke="currentColor" strokeWidth="2"/>
              <path d="M14 14l3 3" stroke="currentColor" strokeWidth="2" strokeLinecap="round"/>
            </svg>
          </button>
          <button className="icon-btn notification-btn">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
              <path d="M10 2a6 6 0 00-6 6v3l-2 2v1h16v-1l-2-2V8a6 6 0 00-6-6zM8 16a2 2 0 104 0"/>
            </svg>
            <span className="notification-badge">1</span>
          </button>
          <button className="icon-btn">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
              <circle cx="10" cy="10" r="8"/>
            </svg>
          </button>
          <button className="icon-btn">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
              <rect x="3" y="3" width="6" height="6" fill="currentColor"/>
              <rect x="11" y="3" width="6" height="6" fill="currentColor"/>
              <rect x="3" y="11" width="6" height="6" fill="currentColor"/>
              <rect x="11" y="11" width="6" height="6" fill="currentColor"/>
            </svg>
          </button>
          <button className="icon-btn">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
              <rect x="2" y="2" width="7" height="7" rx="1"/>
              <rect x="11" y="2" width="7" height="7" rx="1"/>
              <rect x="2" y="11" width="7" height="7" rx="1"/>
              <rect x="11" y="11" width="7" height="7" rx="1"/>
            </svg>
          </button>
        </div>
      </header>

      <div className="layout">
        {/* Sidebar */}
        <aside className="sidebar">
          <div className="project-selector">
            <div className="project-icon">A</div>
            <div className="project-info">
              <div className="project-name">asast-scanner-pipe...</div>
              <div className="project-label">Project</div>
            </div>
            <svg width="12" height="12" viewBox="0 0 12 12" fill="currentColor">
              <path d="M6 8L2 4h8L6 8z"/>
            </svg>
          </div>

          <nav className="sidebar-nav">
            <a href="#" className="sidebar-link">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                <rect x="2" y="2" width="12" height="12" rx="1"/>
              </svg>
              Overview
            </a>
            <a href="#" className="sidebar-link">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                <rect x="2" y="2" width="5" height="5"/>
                <rect x="9" y="2" width="5" height="5"/>
                <rect x="2" y="9" width="5" height="5"/>
                <rect x="9" y="9" width="5" height="5"/>
              </svg>
              Dashboards
              <span className="badge-new">New</span>
              <svg className="chevron" width="12" height="12" viewBox="0 0 12 12" fill="currentColor">
                <path d="M4 2l4 4-4 4V2z"/>
              </svg>
            </a>

            <div className="sidebar-section">Analysis</div>

            <Link href={`/summary/${prId}`} className="sidebar-link">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                <rect x="2" y="10" width="3" height="4"/>
                <rect x="6" y="6" width="3" height="8"/>
                <rect x="10" y="2" width="3" height="12"/>
              </svg>
              Summary
            </Link>
            <a href="#" className="sidebar-link sidebar-link-active">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                <path d="M4 2l4 4-4 4V2zM8 6l4 4-4 4V6z"/>
              </svg>
              Review
            </a>
            <a href="#" className="sidebar-link">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                <path d="M2 2h12v12H2V2zm2 2v8h8V4H4z"/>
              </svg>
              Issues
            </a>
            <a href="#" className="sidebar-link">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                <circle cx="8" cy="8" r="6"/>
              </svg>
              Security Hotspots
            </a>
            <a href="#" className="sidebar-link">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                <path d="M8 2L6 6H2l4 4-2 6 4-3 4 3-2-6 4-4h-4l-2-4z"/>
              </svg>
              Dependency Risks
            </a>
            <a href="#" className="sidebar-link">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                <path d="M2 2h12l-6 12L2 2z"/>
              </svg>
              Security Reports
            </a>
            <a href="#" className="sidebar-link">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                <rect x="2" y="2" width="4" height="4"/>
                <rect x="7" y="2" width="4" height="4"/>
                <rect x="12" y="2" width="2" height="4"/>
                <rect x="2" y="7" width="4" height="7"/>
                <rect x="7" y="7" width="4" height="7"/>
                <rect x="12" y="7" width="2" height="7"/>
              </svg>
              Architecture
              <span className="badge-beta">Beta</span>
            </a>
            <a href="#" className="sidebar-link">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                <path d="M2 6h12v2H2V6zm0 4h12v2H2v-2z"/>
              </svg>
              Measures
            </a>
            <a href="#" className="sidebar-link">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                <path d="M2 2h12v12H2V2zm2 2v8h8V4H4z"/>
                <path d="M6 6h4v4H6V6z"/>
              </svg>
              Code
            </a>
            <a href="#" className="sidebar-link">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                <circle cx="5" cy="5" r="2"/>
                <circle cx="11" cy="5" r="2"/>
                <circle cx="8" cy="11" r="2"/>
                <path d="M5 7l3 4m3-4l-3 4"/>
              </svg>
              Dependencies
            </a>
            <a href="#" className="sidebar-link">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                <path d="M8 2v12M2 8h12"/>
              </svg>
              Activity
            </a>

            <div className="sidebar-section">Information</div>

            <a href="#" className="sidebar-link">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                <path d="M8 2L2 6v4l6 4 6-4V6l-6-4z"/>
              </svg>
              Agent activity
            </a>
            <a href="#" className="sidebar-link">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                <circle cx="8" cy="8" r="6"/>
                <path d="M8 5v4M8 11h.01" stroke="currentColor" strokeWidth="1.5"/>
              </svg>
              Project Information
            </a>
            <Link href="/" className="sidebar-link">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                <path d="M4 2l4 4-4 4V2zM8 6l4 4-4 4V6z"/>
              </svg>
              Pull Requests
              <span className="count-badge">10</span>
            </Link>
            <a href="#" className="sidebar-link">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                <path d="M2 2h12v2H2V2zm0 4h8v2H2V6zm0 4h10v2H2v-2z"/>
              </svg>
              Branches
              <span className="count-badge">1</span>
            </a>
          </nav>
        </aside>

        {/* Main Content */}
        <main className="main-content">
          {/* Page Header - unified breadcrumb and title section */}
          <div className="page-header">
            {/* Breadcrumb */}
            <div className="breadcrumb">
              <a href="#" className="breadcrumb-link">SonarSource</a>
              <span className="breadcrumb-separator">/</span>
              <a href="#" className="breadcrumb-link">asast-scanner-pipeline</a>
              <span className="breadcrumb-separator">/</span>
              <Link href="/" className="breadcrumb-link">Pull Requests</Link>
              <span className="breadcrumb-separator">/</span>
              <span className="breadcrumb-current">{prData.number} - {prData.title}</span>
            </div>

            {/* Title section with Review Button */}
            <div className="page-header-title-section">
              <div>
                <h1 className="pr-detail-title">
                  {prData.number} - {prData.title} <span className="pr-version">#{prData.version}</span>
                </h1>
                <div className="page-metadata">
                  <span className="metadata-item">Private</span>
                  <span className="metadata-separator"></span>
                  <span className="metadata-item">0 New Lines</span>
                  <span className="metadata-separator"></span>
                  <span className="metadata-item">Last analysis 1 month ago</span>
                  <span className="metadata-separator"></span>
                  <span className="metadata-item">
                    d785751e
                  </span>
                  <span className="metadata-separator"></span>
                  <span className="metadata-item">
                    felix/fixMise2 → master
                  </span>
                  {/* <span className="metadata-separator"></span>
                  <div className="warning-badge">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                      <path d="M8 2l6 12H2L8 2z"/>
                      <path d="M8 7v3M8 11h.01" stroke="currentColor" strokeWidth="1.5"/>
                    </svg>
                    Last analysis had warnings
                  </div> */}
                </div>
              </div>
              <div style={{ position: 'relative' }}>
                <button className="btn-review-changes" onClick={() => setShowReviewModal(!showReviewModal)}>
                  Review changes
                  <svg width="12" height="12" viewBox="0 0 12 12" fill="currentColor" style={{ marginLeft: '6px' }}>
                    <path d="M6 8L2 4h8L6 8z"/>
                  </svg>
                </button>

              {/* Review Dropdown Panel */}
              {showReviewModal && (
                <div className="review-dropdown-panel">
                  <div className="review-modal-body">
                    <textarea
                      className="review-textarea"
                      placeholder="Write your review"
                      value={reviewComment}
                      onChange={(e) => setReviewComment(e.target.value)}
                    />

                    <div className="review-options">
                      <div className="review-option" onClick={() => setReviewType('comment')}>
                        <div className={`review-option-radio ${reviewType === 'comment' ? 'selected' : ''}`}></div>
                        <div className="review-option-content">
                          <div className="review-option-label">
                            <span className="review-option-title">Comment</span>
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" className="review-option-icon">
                              <path d="M2 2h12v10H4l-2 2V2z" stroke="currentColor" strokeWidth="1.5" fill="none"/>
                            </svg>
                          </div>
                          <div className="review-option-description">
                            Submit general feedback without explicit approval.
                          </div>
                        </div>
                      </div>

                      <div className="review-option" onClick={() => setReviewType('request-changes')}>
                        <div className={`review-option-radio ${reviewType === 'request-changes' ? 'selected' : ''}`}></div>
                        <div className="review-option-content">
                          <div className="review-option-label">
                            <span className="review-option-title">Request changes</span>
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" className="review-option-icon">
                              <path d="M8 2v12M2 8h12" stroke="currentColor" strokeWidth="2"/>
                            </svg>
                          </div>
                          <div className="review-option-description">
                            Submit feedback that must be addressed before merging.
                          </div>
                        </div>
                      </div>

                      <div className="review-option" onClick={() => setReviewType('approve')}>
                        <div className={`review-option-radio ${reviewType === 'approve' ? 'selected' : ''}`}></div>
                        <div className="review-option-content">
                          <div className="review-option-label">
                            <span className="review-option-title">Approve</span>
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" className="review-option-icon">
                              <path d="M3 8l3 3 7-7" stroke="currentColor" strokeWidth="2" fill="none"/>
                            </svg>
                          </div>
                          <div className="review-option-description">
                            Submit feedback and approve merging these changes.
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div className="review-modal-footer">
                    <div className="review-modal-actions">
                      <button className="btn-review-submit">
                        Submit review
                      </button>
                    </div>
                  </div>
                </div>
              )}
            </div>
          </div>
          </div>

          {/* Files Tab - Always Visible */}
            <>
              {/* Description Section */}
              <div className="pr-section">
                <button
                  className="pr-section-header"
                  onClick={() => setShowDescription(!showDescription)}
                >
                  <svg
                    width="16"
                    height="16"
                    viewBox="0 0 16 16"
                    fill="currentColor"
                    className={`chevron-icon ${showDescription ? 'chevron-expanded' : ''}`}
                  >
                    <path d="M4 6l4 4 4-4" stroke="currentColor" strokeWidth="2" fill="none"/>
                  </svg>
                  <span className="pr-section-title">Descriptions</span>
                </button>
                {showDescription && (
                  <div className="pr-section-content">
                    <div className="pr-description">
                      {prData.description}
                    </div>
                  </div>
                )}
              </div>

              {/* Discussion Section */}
              <div className="pr-section">
                <button
                  className="pr-section-header"
                  onClick={() => setShowDiscussion(!showDiscussion)}
                >
                  <svg
                    width="16"
                    height="16"
                    viewBox="0 0 16 16"
                    fill="currentColor"
                    className={`chevron-icon ${showDiscussion ? 'chevron-expanded' : ''}`}
                  >
                    <path d="M4 6l4 4 4-4" stroke="currentColor" strokeWidth="2" fill="none"/>
                  </svg>
                  <span className="pr-section-title">Discussion</span>
                </button>
                {showDiscussion && (
                  <div className="pr-section-content">
                    {comments.map((comment) => (
                      <div key={comment.id} className="comment-card">
                        <div className="comment-header">
                          <div className="comment-avatar">
                            {comment.isBot ? (
                              <svg width="32" height="32" viewBox="0 0 32 32" fill="currentColor">
                                <circle cx="16" cy="16" r="14" fill="#4a9eff"/>
                                <path d="M12 12h8M10 16h12M12 20h8" stroke="white" strokeWidth="2"/>
                              </svg>
                            ) : (
                              <div className="comment-avatar-text">{comment.avatar}</div>
                            )}
                          </div>
                          <div className="comment-meta">
                            <span className="comment-author">
                              {comment.author}
                              {comment.isBot && <span className="bot-badge">bot</span>}
                            </span>
                            <span className="comment-timestamp">commented {comment.timestamp}</span>
                          </div>
                          <button className="comment-menu">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                              <circle cx="8" cy="4" r="1.5"/>
                              <circle cx="8" cy="8" r="1.5"/>
                              <circle cx="8" cy="12" r="1.5"/>
                            </svg>
                          </button>
                        </div>
                        <div className="comment-body">
                          {comment.content.type === 'quality-gate' ? (
                            <div className="quality-gate-card">
                              <a href="#" className="btn-review-sonarqube">
                                <svg width="190" height="32" viewBox="0 0 190 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                                  <path d="M8 0.5H182C186.142 0.5 189.5 3.85786 189.5 8V24C189.5 28.1421 186.142 31.5 182 31.5H8C3.85786 31.5 0.5 28.1421 0.5 24V8C0.5 3.85786 3.85786 0.5 8 0.5Z" fill="white"/>
                                  <path d="M8 0.5H182C186.142 0.5 189.5 3.85786 189.5 8V24C189.5 28.1421 186.142 31.5 182 31.5H8C3.85786 31.5 0.5 28.1421 0.5 24V8C0.5 3.85786 3.85786 0.5 8 0.5Z" stroke="#C5CDDF"/>
                                  <path d="M28.3211 16.6789C27.9455 16.6789 27.6422 16.3756 27.6422 16C27.6422 10.9582 23.5418 6.85776 18.5 6.85776C18.1244 6.85776 17.8211 6.55453 17.8211 6.17888C17.8211 5.80323 18.1244 5.5 18.5 5.5C24.2886 5.5 29 10.2114 29 16C29 16.3756 28.6968 16.6789 28.3211 16.6789Z" fill="#126ED3"/>
                                  <path d="M18.5 26.5C12.7114 26.5 8 21.7886 8 16C8 15.6244 8.30323 15.3211 8.67888 15.3211C9.05453 15.3211 9.35776 15.6244 9.35776 16C9.35776 21.0418 13.4582 25.1422 18.5 25.1422C18.8756 25.1422 19.1789 25.4455 19.1789 25.8211C19.1789 26.1968 18.8756 26.5 18.5 26.5Z" fill="#126ED3"/>
                                  <path d="M21.4463 16.6789C21.0707 16.6789 20.7675 16.3756 20.7675 16C20.7675 14.7509 19.7491 13.7325 18.5 13.7325C18.1244 13.7325 17.8211 13.4293 17.8211 13.0537C17.8211 12.678 18.1244 12.3748 18.5 12.3748C20.5004 12.3748 22.1252 13.9996 22.1252 16C22.1252 16.3756 21.822 16.6789 21.4463 16.6789Z" fill="#126ED3"/>
                                  <path d="M18.5 19.6252C16.4996 19.6252 14.8748 18.0004 14.8748 16C14.8748 15.6244 15.178 15.3211 15.5537 15.3211C15.9293 15.3211 16.2325 15.6244 16.2325 16C16.2325 17.2491 17.2509 18.2675 18.5 18.2675C18.8756 18.2675 19.1789 18.5707 19.1789 18.9463C19.1789 19.322 18.8756 19.6252 18.5 19.6252Z" fill="#126ED3"/>
                                  <path d="M24.8815 16.6789C24.5058 16.6789 24.2026 16.3756 24.2026 16C24.2026 12.8545 21.6455 10.2974 18.5 10.2974C18.1244 10.2974 17.8211 9.99418 17.8211 9.61853C17.8211 9.24289 18.1244 8.93965 18.5 8.93965C22.3922 8.93965 25.5603 12.1078 25.5603 16C25.5603 16.3756 25.2571 16.6789 24.8815 16.6789Z" fill="#126ED3"/>
                                  <path d="M18.5 23.0603C14.6078 23.0603 11.4397 19.8922 11.4397 16C11.4397 15.6244 11.7429 15.3211 12.1185 15.3211C12.4942 15.3211 12.7974 15.6244 12.7974 16C12.7974 19.1455 15.3545 21.7026 18.5 21.7026C18.8756 21.7026 19.1789 22.0058 19.1789 22.3815C19.1789 22.7571 18.8756 23.0603 18.5 23.0603Z" fill="#126ED3"/>
                                  <path d="M38.4466 21V10.8182H42.2648C43.047 10.8182 43.7033 10.9541 44.2336 11.2259C44.7672 11.4976 45.1699 11.8788 45.4417 12.3693C45.7168 12.8565 45.8543 13.425 45.8543 14.0746C45.8543 14.7275 45.7151 15.2943 45.4367 15.7749C45.1616 16.2521 44.7556 16.6217 44.2187 16.8835C43.6817 17.142 43.0222 17.2713 42.24 17.2713H39.5205V15.7401H41.9914C42.4488 15.7401 42.8233 15.6771 43.115 15.5511C43.4066 15.4219 43.6221 15.2346 43.7613 14.9893C43.9038 14.7408 43.9751 14.4358 43.9751 14.0746C43.9751 13.7133 43.9038 13.4051 43.7613 13.1499C43.6188 12.8913 43.4017 12.6958 43.11 12.5632C42.8183 12.4273 42.4421 12.3594 41.9814 12.3594H40.2911V21H38.4466ZM43.7066 16.3864L46.2272 21H44.1689L41.6931 16.3864H43.7066ZM50.7439 21.1491C49.9782 21.1491 49.317 20.9901 48.7602 20.6719C48.2067 20.3504 47.7808 19.8963 47.4825 19.3097C47.1842 18.7197 47.0351 18.0253 47.0351 17.2266C47.0351 16.4411 47.1842 15.7517 47.4825 15.1584C47.7841 14.5618 48.205 14.0978 48.7453 13.7663C49.2855 13.4316 49.9202 13.2642 50.6494 13.2642C51.1201 13.2642 51.5642 13.3404 51.9818 13.4929C52.4027 13.642 52.7739 13.8741 53.0954 14.1889C53.4202 14.5038 53.6755 14.9048 53.8611 15.392C54.0467 15.8759 54.1395 16.4527 54.1395 17.1222V17.674H47.8802V16.4609H52.4143C52.411 16.1162 52.3364 15.8097 52.1906 15.5412C52.0448 15.2694 51.8409 15.0556 51.5791 14.8999C51.3206 14.7441 51.019 14.6662 50.6743 14.6662C50.3064 14.6662 49.9832 14.7557 49.7048 14.9347C49.4264 15.1103 49.2093 15.3423 49.0535 15.6307C48.9011 15.9157 48.8232 16.2289 48.8199 16.5703V17.6293C48.8199 18.0734 48.9011 18.4545 49.0635 18.7727C49.2259 19.0876 49.4529 19.3295 49.7446 19.4986C50.0363 19.6643 50.3776 19.7472 50.7687 19.7472C51.0306 19.7472 51.2675 19.7107 51.4797 19.6378C51.6918 19.5616 51.8757 19.4505 52.0315 19.3047C52.1873 19.1589 52.305 18.9782 52.3845 18.7628L54.0649 18.9517C53.9588 19.3958 53.7567 19.7836 53.4584 20.1151C53.1634 20.4432 52.7855 20.6984 52.3248 20.8807C51.8641 21.0597 51.3372 21.1491 50.7439 21.1491ZM62.2643 13.3636L59.5448 21H57.5562L54.8367 13.3636H56.7558L58.5107 19.0362H58.5903L60.3502 13.3636H62.2643ZM63.5097 21V13.3636H65.3094V21H63.5097ZM64.4145 12.2798C64.1295 12.2798 63.8842 12.1854 63.6787 11.9964C63.4732 11.8042 63.3705 11.5739 63.3705 11.3054C63.3705 11.0336 63.4732 10.8033 63.6787 10.6143C63.8842 10.4221 64.1295 10.326 64.4145 10.326C64.7029 10.326 64.9481 10.4221 65.1503 10.6143C65.3558 10.8033 65.4585 11.0336 65.4585 11.3054C65.4585 11.5739 65.3558 11.8042 65.1503 11.9964C64.9481 12.1854 64.7029 12.2798 64.4145 12.2798ZM70.5407 21.1491C69.7751 21.1491 69.1139 20.9901 68.5571 20.6719C68.0036 20.3504 67.5777 19.8963 67.2794 19.3097C66.9811 18.7197 66.8319 18.0253 66.8319 17.2266C66.8319 16.4411 66.9811 15.7517 67.2794 15.1584C67.581 14.5618 68.0019 14.0978 68.5422 13.7663C69.0824 13.4316 69.7171 13.2642 70.4463 13.2642C70.9169 13.2642 71.3611 13.3404 71.7787 13.4929C72.1996 13.642 72.5708 13.8741 72.8923 14.1889C73.2171 14.5038 73.4723 14.9048 73.6579 15.392C73.8435 15.8759 73.9363 16.4527 73.9363 17.1222V17.674H67.6771V16.4609H72.2112C72.2079 16.1162 72.1333 15.8097 71.9875 15.5412C71.8416 15.2694 71.6378 15.0556 71.376 14.8999C71.1175 14.7441 70.8158 14.6662 70.4711 14.6662C70.1032 14.6662 69.7801 14.7557 69.5017 14.9347C69.2233 15.1103 69.0062 15.3423 68.8504 15.6307C68.6979 15.9157 68.6201 16.2289 68.6167 16.5703V17.6293C68.6167 18.0734 68.6979 18.4545 68.8604 18.7727C69.0228 19.0876 69.2498 19.3295 69.5415 19.4986C69.8331 19.6643 70.1745 19.7472 70.5656 19.7472C70.8274 19.7472 71.0644 19.7107 71.2765 19.6378C71.4887 19.5616 71.6726 19.4505 71.8284 19.3047C71.9842 19.1589 72.1018 18.9782 72.1814 18.7628L73.8618 18.9517C73.7557 19.3958 73.5535 19.7836 73.2552 20.1151C72.9603 20.4432 72.5824 20.6984 72.1217 20.8807C71.661 21.0597 71.134 21.1491 70.5407 21.1491ZM76.9939 21L74.8362 13.3636H76.6707L78.0131 18.733H78.0827L79.4548 13.3636H81.2694L82.6416 18.7031H82.7162L84.0386 13.3636H85.8781L83.7155 21H81.8412L80.4094 15.8395H80.305L78.8731 21H76.9939ZM90.6073 21V13.3636H92.407V21H90.6073ZM91.5122 12.2798C91.2271 12.2798 90.9819 12.1854 90.7764 11.9964C90.5709 11.8042 90.4681 11.5739 90.4681 11.3054C90.4681 11.0336 90.5709 10.8033 90.7764 10.6143C90.9819 10.4221 91.2271 10.326 91.5122 10.326C91.8005 10.326 92.0458 10.4221 92.248 10.6143C92.4535 10.8033 92.5562 11.0336 92.5562 11.3054C92.5562 11.5739 92.4535 11.8042 92.248 11.9964C92.0458 12.1854 91.8005 12.2798 91.5122 12.2798ZM96.0574 16.5256V21H94.2577V13.3636H95.9779V14.6612H96.0674C96.243 14.2337 96.5231 13.8939 96.9076 13.642C97.2954 13.3902 97.7743 13.2642 98.3444 13.2642C98.8714 13.2642 99.3304 13.3769 99.7215 13.6023C100.116 13.8277 100.421 14.1541 100.636 14.5817C100.855 15.0092 100.963 15.5279 100.959 16.1378V21H99.1597V16.4162C99.1597 15.9058 99.0271 15.5064 98.762 15.218C98.5001 14.9297 98.1372 14.7855 97.6732 14.7855C97.3583 14.7855 97.0783 14.8551 96.833 14.9943C96.5911 15.1302 96.4005 15.3274 96.2613 15.5859C96.1254 15.8445 96.0574 16.1577 96.0574 16.5256ZM111.875 13.6172C111.828 13.183 111.633 12.8449 111.288 12.603C110.947 12.361 110.502 12.2401 109.956 12.2401C109.571 12.2401 109.241 12.2981 108.966 12.4141C108.691 12.5301 108.481 12.6875 108.335 12.8864C108.189 13.0852 108.114 13.3123 108.111 13.5675C108.111 13.7796 108.159 13.9635 108.255 14.1193C108.355 14.2751 108.489 14.4077 108.658 14.517C108.827 14.6231 109.014 14.7126 109.22 14.7855C109.425 14.8584 109.632 14.9197 109.841 14.9695L110.796 15.2081C111.18 15.2976 111.55 15.4186 111.904 15.571C112.262 15.7235 112.582 15.9157 112.864 16.1477C113.149 16.3797 113.374 16.6598 113.54 16.9879C113.706 17.3161 113.789 17.7005 113.789 18.1413C113.789 18.7379 113.636 19.2633 113.331 19.7173C113.026 20.1681 112.585 20.5211 112.009 20.7763C111.435 21.0282 110.741 21.1541 109.926 21.1541C109.134 21.1541 108.446 21.0315 107.862 20.7862C107.282 20.541 106.828 20.183 106.5 19.7124C106.175 19.2417 106 18.6683 105.973 17.9922H107.788C107.814 18.3468 107.924 18.6418 108.116 18.8771C108.308 19.1125 108.559 19.2881 108.867 19.4041C109.178 19.5201 109.526 19.5781 109.911 19.5781C110.312 19.5781 110.663 19.5185 110.965 19.3991C111.27 19.2765 111.508 19.1075 111.681 18.892C111.853 18.6733 111.941 18.4181 111.944 18.1264C111.941 17.8613 111.863 17.6425 111.71 17.4702C111.558 17.2945 111.344 17.1487 111.069 17.0327C110.797 16.9134 110.479 16.8073 110.115 16.7145L108.956 16.4162C108.118 16.2008 107.455 15.8743 106.968 15.4368C106.484 14.996 106.242 14.411 106.242 13.6818C106.242 13.0819 106.404 12.5566 106.729 12.1058C107.057 11.6551 107.503 11.3054 108.066 11.0568C108.63 10.8049 109.268 10.679 109.98 10.679C110.703 10.679 111.336 10.8049 111.88 11.0568C112.426 11.3054 112.856 11.6518 113.167 12.0959C113.479 12.5367 113.639 13.0438 113.649 13.6172H111.875ZM118.684 21.1491C117.939 21.1491 117.292 20.9851 116.745 20.657C116.199 20.3288 115.774 19.8698 115.473 19.2798C115.174 18.6899 115.025 18.0005 115.025 17.2116C115.025 16.4228 115.174 15.7318 115.473 15.1385C115.774 14.5452 116.199 14.0845 116.745 13.7564C117.292 13.4283 117.939 13.2642 118.684 13.2642C119.43 13.2642 120.076 13.4283 120.623 13.7564C121.17 14.0845 121.593 14.5452 121.891 15.1385C122.193 15.7318 122.343 16.4228 122.343 17.2116C122.343 18.0005 122.193 18.6899 121.891 19.2798C121.593 19.8698 121.17 20.3288 120.623 20.657C120.076 20.9851 119.43 21.1491 118.684 21.1491ZM118.694 19.7074C119.099 19.7074 119.437 19.5964 119.709 19.3743C119.98 19.1489 120.182 18.8473 120.315 18.4695C120.451 18.0916 120.519 17.6707 120.519 17.2067C120.519 16.7393 120.451 16.3168 120.315 15.9389C120.182 15.5578 119.98 15.2545 119.709 15.0291C119.437 14.8037 119.099 14.6911 118.694 14.6911C118.28 14.6911 117.935 14.8037 117.66 15.0291C117.388 15.2545 117.185 15.5578 117.049 15.9389C116.916 16.3168 116.85 16.7393 116.85 17.2067C116.85 17.6707 116.916 18.0916 117.049 18.4695C117.185 18.8473 117.388 19.1489 117.66 19.3743C117.935 19.5964 118.28 19.7074 118.694 19.7074ZM125.671 16.5256V21H123.871V13.3636H125.591V14.6612H125.681C125.856 14.2337 126.136 13.8939 126.521 13.642C126.909 13.3902 127.388 13.2642 127.958 13.2642C128.485 13.2642 128.944 13.3769 129.335 13.6023C129.729 13.8277 130.034 14.1541 130.25 14.5817C130.468 15.0092 130.576 15.5279 130.573 16.1378V21H128.773V16.4162C128.773 15.9058 128.64 15.5064 128.375 15.218C128.113 14.9297 127.751 14.7855 127.286 14.7855C126.972 14.7855 126.692 14.8551 126.446 14.9943C126.204 15.1302 126.014 15.3274 125.875 15.5859C125.739 15.8445 125.671 16.1577 125.671 16.5256ZM134.6 21.1541C134.116 21.1541 133.68 21.0679 133.292 20.8956C132.908 20.7199 132.603 20.4614 132.377 20.12C132.155 19.7786 132.044 19.3577 132.044 18.8572C132.044 18.4264 132.124 18.0701 132.283 17.7884C132.442 17.5066 132.659 17.2812 132.934 17.1122C133.209 16.9432 133.519 16.8156 133.864 16.7294C134.212 16.6399 134.572 16.5753 134.943 16.5355C135.39 16.4891 135.753 16.4477 136.032 16.4112C136.31 16.3714 136.512 16.3118 136.638 16.2322C136.767 16.1494 136.832 16.0218 136.832 15.8494V15.8196C136.832 15.4451 136.721 15.1551 136.499 14.9496C136.277 14.7441 135.957 14.6413 135.539 14.6413C135.099 14.6413 134.749 14.7375 134.49 14.9297C134.235 15.1219 134.063 15.349 133.973 15.6108L132.293 15.3722C132.425 14.9081 132.644 14.5204 132.949 14.2088C133.254 13.8939 133.627 13.6586 134.068 13.5028C134.509 13.3438 134.996 13.2642 135.529 13.2642C135.897 13.2642 136.264 13.3073 136.628 13.3935C136.993 13.4796 137.326 13.6222 137.627 13.821C137.929 14.0166 138.171 14.2834 138.353 14.6214C138.539 14.9595 138.632 15.3821 138.632 15.8892V21H136.902V19.951H136.842C136.733 20.1631 136.578 20.362 136.38 20.5476C136.184 20.7299 135.937 20.8774 135.639 20.9901C135.344 21.0994 134.997 21.1541 134.6 21.1541ZM135.067 19.8317C135.428 19.8317 135.742 19.7604 136.007 19.6179C136.272 19.4721 136.476 19.2798 136.618 19.0412C136.764 18.8026 136.837 18.5424 136.837 18.2607V17.3608C136.781 17.4072 136.684 17.4503 136.549 17.4901C136.416 17.5298 136.267 17.5646 136.101 17.5945C135.935 17.6243 135.771 17.6508 135.609 17.674C135.447 17.6972 135.306 17.7171 135.186 17.7337C134.918 17.7701 134.678 17.8298 134.465 17.9126C134.253 17.9955 134.086 18.1115 133.963 18.2607C133.841 18.4065 133.779 18.5954 133.779 18.8274C133.779 19.1589 133.9 19.4091 134.142 19.5781C134.384 19.7472 134.693 19.8317 135.067 19.8317ZM140.441 21V13.3636H142.186V14.6364H142.266C142.405 14.1955 142.644 13.8558 142.982 13.6172C143.323 13.3752 143.713 13.2543 144.15 13.2543C144.25 13.2543 144.361 13.2592 144.483 13.2692C144.609 13.2758 144.714 13.2874 144.796 13.304V14.9595C144.72 14.933 144.599 14.9098 144.434 14.8899C144.271 14.8667 144.114 14.8551 143.961 14.8551C143.633 14.8551 143.338 14.9264 143.076 15.0689C142.818 15.2081 142.614 15.402 142.465 15.6506C142.316 15.8991 142.241 16.1858 142.241 16.5107V21H140.441ZM149.865 17.5795H151.535L152.525 18.8622L153.231 19.6974L154.926 21.875H153.136L151.983 20.4134L151.491 19.7173L149.865 17.5795ZM155.17 15.9091C155.17 17.0062 154.964 17.9458 154.553 18.728C154.146 19.5069 153.589 20.1035 152.883 20.5178C152.18 20.9321 151.383 21.1392 150.491 21.1392C149.6 21.1392 148.801 20.9321 148.095 20.5178C147.392 20.1001 146.836 19.5019 146.425 18.723C146.017 17.9408 145.813 17.0028 145.813 15.9091C145.813 14.812 146.017 13.8741 146.425 13.0952C146.836 12.313 147.392 11.7147 148.095 11.3004C148.801 10.8861 149.6 10.679 150.491 10.679C151.383 10.679 152.18 10.8861 152.883 11.3004C153.589 11.7147 154.146 12.313 154.553 13.0952C154.964 13.8741 155.17 14.812 155.17 15.9091ZM153.315 15.9091C153.315 15.1368 153.194 14.4856 152.952 13.9553C152.714 13.4216 152.382 13.0189 151.958 12.7472C151.534 12.4721 151.045 12.3345 150.491 12.3345C149.938 12.3345 149.449 12.4721 149.025 12.7472C148.601 13.0189 148.267 13.4216 148.025 13.9553C147.787 14.4856 147.668 15.1368 147.668 15.9091C147.668 16.6813 147.787 17.3343 148.025 17.8679C148.267 18.3982 148.601 18.8009 149.025 19.076C149.449 19.3478 149.938 19.4837 150.491 19.4837C151.045 19.4837 151.534 19.3478 151.958 19.076C152.382 18.8009 152.714 18.3982 152.952 17.8679C153.194 17.3343 153.315 16.6813 153.315 15.9091ZM161.715 17.7884V13.3636H163.514V21H161.769V19.6428H161.69C161.518 20.0703 161.234 20.42 160.84 20.6918C160.449 20.9635 159.966 21.0994 159.393 21.0994C158.893 21.0994 158.45 20.9884 158.066 20.7663C157.684 20.541 157.386 20.2145 157.171 19.7869C156.955 19.3561 156.848 18.8357 156.848 18.2259V13.3636H158.647V17.9474C158.647 18.4313 158.78 18.8158 159.045 19.1009C159.31 19.3859 159.658 19.5284 160.089 19.5284C160.354 19.5284 160.611 19.4638 160.86 19.3345C161.108 19.2053 161.312 19.013 161.471 18.7578C161.634 18.4993 161.715 18.1761 161.715 17.7884ZM165.445 21V10.8182H167.244V14.6264H167.319C167.412 14.4408 167.543 14.2436 167.712 14.0348C167.881 13.8227 168.109 13.642 168.398 13.4929C168.686 13.3404 169.054 13.2642 169.502 13.2642C170.091 13.2642 170.623 13.415 171.097 13.7166C171.575 14.0149 171.953 14.4574 172.231 15.044C172.513 15.6274 172.653 16.3433 172.653 17.1918C172.653 18.0303 172.516 18.7429 172.241 19.3295C171.966 19.9162 171.591 20.3636 171.117 20.6719C170.643 20.9801 170.106 21.1342 169.506 21.1342C169.069 21.1342 168.706 21.0613 168.418 20.9155C168.129 20.7696 167.897 20.594 167.722 20.3885C167.549 20.1797 167.415 19.9825 167.319 19.7969H167.215V21H165.445ZM167.21 17.1818C167.21 17.6757 167.279 18.1082 167.418 18.4794C167.561 18.8506 167.765 19.1406 168.03 19.3494C168.298 19.5549 168.623 19.6577 169.004 19.6577C169.402 19.6577 169.735 19.5516 170.004 19.3395C170.272 19.1241 170.474 18.8307 170.61 18.4595C170.749 18.085 170.819 17.6591 170.819 17.1818C170.819 16.7079 170.751 16.2869 170.615 15.919C170.479 15.5511 170.277 15.2628 170.009 15.054C169.74 14.8452 169.405 14.7408 169.004 14.7408C168.62 14.7408 168.293 14.8419 168.025 15.044C167.756 15.2462 167.553 15.5296 167.413 15.8942C167.278 16.2588 167.21 16.688 167.21 17.1818ZM177.564 21.1491C176.799 21.1491 176.137 20.9901 175.581 20.6719C175.027 20.3504 174.601 19.8963 174.303 19.3097C174.005 18.7197 173.855 18.0253 173.855 17.2266C173.855 16.4411 174.005 15.7517 174.303 15.1584C174.604 14.5618 175.025 14.0978 175.566 13.7663C176.106 13.4316 176.741 13.2642 177.47 13.2642C177.94 13.2642 178.384 13.3404 178.802 13.4929C179.223 13.642 179.594 13.8741 179.916 14.1889C180.241 14.5038 180.496 14.9048 180.681 15.392C180.867 15.8759 180.96 16.4527 180.96 17.1222V17.674H174.701V16.4609H179.235C179.231 16.1162 179.157 15.8097 179.011 15.5412C178.865 15.2694 178.661 15.0556 178.399 14.8999C178.141 14.7441 177.839 14.6662 177.495 14.6662C177.127 14.6662 176.804 14.7557 176.525 14.9347C176.247 15.1103 176.03 15.3423 175.874 15.6307C175.721 15.9157 175.643 16.2289 175.64 16.5703V17.6293C175.64 18.0734 175.721 18.4545 175.884 18.7727C176.046 19.0876 176.273 19.3295 176.565 19.4986C176.857 19.6643 177.198 19.7472 177.589 19.7472C177.851 19.7472 178.088 19.7107 178.3 19.6378C178.512 19.5616 178.696 19.4505 178.852 19.3047C179.008 19.1589 179.125 18.9782 179.205 18.7628L180.885 18.9517C180.779 19.3958 180.577 19.7836 180.279 20.1151C179.984 20.4432 179.606 20.6984 179.145 20.8807C178.684 21.0597 178.157 21.1491 177.564 21.1491Z" fill="#3E4357"/>
                                </svg>
                              </a>
                              <div className="quality-gate-status">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                  <path d="M4 10l4 4 8-8" stroke="#4caf50" strokeWidth="2" fill="none"/>
                                </svg>
                                <span className="quality-gate-text">Quality Gate passed</span>
                              </div>
                              <div className="quality-metrics">
                                <div className="metric-section">
                                  <h4 className="metric-header">Issues</h4>
                                  <div className="metric-item">
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                      <path d="M4 8l4 4 8-8" stroke="#4caf50" strokeWidth="2" fill="none"/>
                                    </svg>
                                    <a href="#" className="metric-link">{comment.content.metrics?.newIssues} New issues</a>
                                  </div>
                                  <div className="metric-item">
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                      <circle cx="8" cy="8" r="6" stroke="#f5a623" strokeWidth="1.5" fill="none"/>
                                    </svg>
                                    <a href="#" className="metric-link">{comment.content.metrics?.acceptedIssues} Accepted issues</a>
                                  </div>
                                </div>
                                <div className="metric-section">
                                  <h4 className="metric-header">Measures</h4>
                                  <div className="metric-item">
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                      <path d="M4 8l4 4 8-8" stroke="#4caf50" strokeWidth="2" fill="none"/>
                                    </svg>
                                    <a href="#" className="metric-link">{comment.content.metrics?.securityHotspots} Security Hotspots</a>
                                  </div>
                                  <div className="metric-item">
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                      <path d="M4 8l4 4 8-8" stroke="#4caf50" strokeWidth="2" fill="none"/>
                                    </svg>
                                    <a href="#" className="metric-link">{comment.content.metrics?.coverageOnNew} Coverage on New Code</a>
                                  </div>
                                  <div className="metric-item">
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                      <path d="M4 8l4 4 8-8" stroke="#4caf50" strokeWidth="2" fill="none"/>
                                    </svg>
                                    <a href="#" className="metric-link">{comment.content.metrics?.duplicationOnNew} Duplication on New Code</a>
                                  </div>
                                </div>
                              </div>
                            </div>
                          ) : (
                            <p className="comment-text">{comment.content.text}</p>
                          )}
                        </div>
                      </div>
                    ))}
                  </div>
                )}
              </div>
            </>
          )}

          {activeTab === 'files' && (
            <div className="files-tab-container">
              {/* Quality Gate Summary - Full Width at Top */}
              <div className="files-quality-gate">
                <div className="quality-gate-header-row">
                  <h3 className="files-quality-gate-title">Quality Gate:</h3>
                  <div className="quality-gate-badge">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                      <path d="M4 10l4 4 8-8" stroke="#4caf50" strokeWidth="2" fill="none"/>
                    </svg>
                    <span>Passed</span>
                  </div>
                </div>
                <div className="quality-metrics-inline">
                  <div className="metric-inline">
                    <CoverageIndicator percentage={100} size={16} />
                    <span>Reliability Rating</span>
                    <span className="metric-required">Rating required B</span>
                  </div>
                  <div className="metric-inline">
                    <CoverageIndicator percentage={0} size={16} inverted={true} />
                    <span>0.0% Duplicated Lines (%)</span>
                    <span className="metric-required">≤ 3.0% required</span>
                  </div>
                  <div className="metric-inline">
                    <CoverageIndicator percentage={100} size={16} />
                    <span>100% Security Hotspots Reviewed</span>
                    <span className="metric-required">≥ 100% required</span>
                  </div>
                  <div className="metric-inline">
                    <span className="metric-number">0</span>
                    <span>Issues</span>
                    <span className="metric-required">≤ 0 required</span>
                  </div>
                </div>
              </div>

              {/* Two Column Layout: Groups on left, File changes on right */}
              <div className="files-view">
                {/* Left sidebar - Groups */}
                <div className="files-groups">
                  <div className="files-groups-header">
                  <span>Groups</span>
                  <span className="groups-count">0 / 3</span>
                </div>

                {/* Group 1: CI/CD Workflow */}
                <div className="file-group">
                  <div style={{ display: 'flex', alignItems: 'flex-start', width: '100%' }}>
                    {groupReviewed1 ? (
                      <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" style={{ marginRight: '8px', marginTop: '2px', flexShrink: 0, color: '#4CAF50' }}>
                        <circle cx="8" cy="8" r="7" stroke="currentColor" strokeWidth="1.5" fill="none"/>
                        <path d="M5 8l2 2 4-4" stroke="currentColor" strokeWidth="2" fill="none"/>
                      </svg>
                    ) : (
                      <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" style={{ marginRight: '8px', marginTop: '2px', flexShrink: 0, color: 'var(--color-text-muted)' }}>
                        <path d="M2 3h5l2 2h5v8H2V3z" stroke="currentColor" strokeWidth="1" fill="none"/>
                      </svg>
                    )}
                    <div style={{ flex: 1, overflow: 'hidden' }}>
                      <div
                        className="file-group-name"
                        style={{
                          fontWeight: 500,
                          marginBottom: showGroupFiles ? '8px' : '0',
                          cursor: 'pointer',
                          color: groupReviewed1 ? '#4CAF50' : 'inherit'
                        }}
                        onClick={() => setShowGroupFiles(!showGroupFiles)}
                      >
                        CI/CD Workflow Refactoring
                      </div>
                      {showGroupFiles && (
                        <div style={{ fontSize: '12px', color: 'var(--color-text-muted)', paddingLeft: '8px' }}>
                          <div style={{
                            marginBottom: '4px',
                            overflow: 'hidden',
                            textOverflow: 'ellipsis',
                            whiteSpace: 'nowrap',
                            direction: 'rtl',
                            textAlign: 'left'
                          }}>
                            github/actions/npm-setup/action.yml
                          </div>
                          <div style={{
                            marginBottom: '4px',
                            overflow: 'hidden',
                            textOverflow: 'ellipsis',
                            whiteSpace: 'nowrap',
                            direction: 'rtl',
                            textAlign: 'left'
                          }}>
                            .github/workflows/build.yml
                          </div>
                          <div style={{
                            overflow: 'hidden',
                            textOverflow: 'ellipsis',
                            whiteSpace: 'nowrap',
                            direction: 'rtl',
                            textAlign: 'left'
                          }}>
                            .github/workflows/deploy.yml
                          </div>
                        </div>
                      )}
                    </div>
                    <button
                      className="file-group-toggle"
                      onClick={() => setShowGroupFiles(!showGroupFiles)}
                      style={{ marginLeft: '8px', flexShrink: 0, marginTop: '2px' }}
                    >
                      <svg
                        width="16"
                        height="16"
                        viewBox="0 0 16 16"
                        fill="currentColor"
                        style={{
                          transform: showGroupFiles ? 'rotate(0deg)' : 'rotate(-90deg)',
                          transition: 'transform 0.2s'
                        }}
                      >
                        <path d="M4 6l4 4 4-4" stroke="currentColor" strokeWidth="2" fill="none"/>
                      </svg>
                    </button>
                  </div>
                </div>

                {/* Group 2: API Authentication */}
                <div className="file-group">
                  <div style={{ display: 'flex', alignItems: 'flex-start', width: '100%' }}>
                    {groupReviewed2 ? (
                      <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" style={{ marginRight: '8px', marginTop: '2px', flexShrink: 0, color: '#4CAF50' }}>
                        <circle cx="8" cy="8" r="7" stroke="currentColor" strokeWidth="1.5" fill="none"/>
                        <path d="M5 8l2 2 4-4" stroke="currentColor" strokeWidth="2" fill="none"/>
                      </svg>
                    ) : (
                      <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" style={{ marginRight: '8px', marginTop: '2px', flexShrink: 0, color: 'var(--color-text-muted)' }}>
                        <path d="M2 3h5l2 2h5v8H2V3z" stroke="currentColor" strokeWidth="1" fill="none"/>
                      </svg>
                    )}
                    <div style={{ flex: 1, overflow: 'hidden' }}>
                      <div
                        className="file-group-name"
                        style={{
                          fontWeight: 500,
                          marginBottom: showGroupFiles2 ? '8px' : '0',
                          cursor: 'pointer',
                          color: groupReviewed2 ? '#4CAF50' : 'inherit'
                        }}
                        onClick={() => setShowGroupFiles2(!showGroupFiles2)}
                      >
                        API Authentication & Security
                      </div>
                      {showGroupFiles2 && (
                        <div style={{ fontSize: '12px', color: 'var(--color-text-muted)', paddingLeft: '8px' }}>
                          <div style={{
                            marginBottom: '4px',
                            overflow: 'hidden',
                            textOverflow: 'ellipsis',
                            whiteSpace: 'nowrap',
                            direction: 'rtl',
                            textAlign: 'left'
                          }}>
                            src/middleware/auth.ts
                          </div>
                          <div style={{
                            overflow: 'hidden',
                            textOverflow: 'ellipsis',
                            whiteSpace: 'nowrap',
                            direction: 'rtl',
                            textAlign: 'left'
                          }}>
                            src/api/refresh-token.ts
                          </div>
                        </div>
                      )}
                    </div>
                    <button
                      className="file-group-toggle"
                      onClick={() => setShowGroupFiles2(!showGroupFiles2)}
                      style={{ marginLeft: '8px', flexShrink: 0, marginTop: '2px' }}
                    >
                      <svg
                        width="16"
                        height="16"
                        viewBox="0 0 16 16"
                        fill="currentColor"
                        style={{
                          transform: showGroupFiles2 ? 'rotate(0deg)' : 'rotate(-90deg)',
                          transition: 'transform 0.2s'
                        }}
                      >
                        <path d="M4 6l4 4 4-4" stroke="currentColor" strokeWidth="2" fill="none"/>
                      </svg>
                    </button>
                  </div>
                </div>

                {/* Group 3: Database Migration */}
                <div className="file-group">
                  <div style={{ display: 'flex', alignItems: 'flex-start', width: '100%' }}>
                    {groupReviewed3 ? (
                      <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" style={{ marginRight: '8px', marginTop: '2px', flexShrink: 0, color: '#4CAF50' }}>
                        <circle cx="8" cy="8" r="7" stroke="currentColor" strokeWidth="1.5" fill="none"/>
                        <path d="M5 8l2 2 4-4" stroke="currentColor" strokeWidth="2" fill="none"/>
                      </svg>
                    ) : (
                      <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" style={{ marginRight: '8px', marginTop: '2px', flexShrink: 0, color: 'var(--color-text-muted)' }}>
                        <path d="M2 3h5l2 2h5v8H2V3z" stroke="currentColor" strokeWidth="1" fill="none"/>
                      </svg>
                    )}
                    <div style={{ flex: 1, overflow: 'hidden' }}>
                      <div
                        className="file-group-name"
                        style={{
                          fontWeight: 500,
                          marginBottom: showGroupFiles3 ? '8px' : '0',
                          cursor: 'pointer',
                          color: groupReviewed3 ? '#4CAF50' : 'inherit'
                        }}
                        onClick={() => setShowGroupFiles3(!showGroupFiles3)}
                      >
                        Database Schema Migration
                      </div>
                      {showGroupFiles3 && (
                        <div style={{ fontSize: '12px', color: 'var(--color-text-muted)', paddingLeft: '8px' }}>
                          <div style={{
                            overflow: 'hidden',
                            textOverflow: 'ellipsis',
                            whiteSpace: 'nowrap',
                            direction: 'rtl',
                            textAlign: 'left'
                          }}>
                            migrations/20260119_add_user_preferences.sql
                          </div>
                        </div>
                      )}
                    </div>
                    <button
                      className="file-group-toggle"
                      onClick={() => setShowGroupFiles3(!showGroupFiles3)}
                      style={{ marginLeft: '8px', flexShrink: 0, marginTop: '2px' }}
                    >
                      <svg
                        width="16"
                        height="16"
                        viewBox="0 0 16 16"
                        fill="currentColor"
                        style={{
                          transform: showGroupFiles3 ? 'rotate(0deg)' : 'rotate(-90deg)',
                          transition: 'transform 0.2s'
                        }}
                      >
                        <path d="M4 6l4 4 4-4" stroke="currentColor" strokeWidth="2" fill="none"/>
                      </svg>
                    </button>
                  </div>
                </div>
              </div>

              {/* Right content - File changes */}
              <div className="files-content">
                {/* File Change Card */}
                <div className="file-change-card">
                  <div className="file-change-header" style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between' }}>
                    <div style={{ display: 'flex', alignItems: 'center', gap: '12px', flex: 1 }}>
                      <h3 style={{ margin: 0 }}>CI/CD Workflow Refactoring with NPM Setup</h3>
                      <span className="needs-review-badge">Needs review</span>
                      <div className="file-change-meta" style={{ display: 'flex', alignItems: 'center', gap: '8px', marginLeft: 'auto' }}>
                        <span className="file-count">3 files</span>
                        <span className="additions">+25</span>
                        <span className="deletions">-9</span>
                      </div>
                    </div>
                    <button
                      className="pin-button"
                      onClick={() => setShowFileChanges(!showFileChanges)}
                      style={{ marginLeft: '12px' }}
                    >
                      <svg
                        width="16"
                        height="16"
                        viewBox="0 0 16 16"
                        fill="currentColor"
                        style={{
                          transform: showFileChanges ? 'rotate(0deg)' : 'rotate(-90deg)',
                          transition: 'transform 0.2s'
                        }}
                      >
                        <path d="M4 6l4 4 4-4" stroke="currentColor" strokeWidth="2" fill="none"/>
                      </svg>
                    </button>
                  </div>

                  {showFileChanges && (
                    <>
                      <div className="file-change-description">
                        <p>Refactored GitHub Actions workflows by extracting npm setup logic into a reusable composite action and integrating it into existing workflows.</p>
                        <p className="review-focus"><strong>Review Focus:</strong> Review the new composite action for proper node/npm configuration, caching strategy, and dependencies. Verify the workflow changes correctly reference the new action and that removed setup steps are adequately replaced.</p>
                      </div>

                      {/* Code Diff */}
                      <div className="code-diff-container">
                    <div className="code-diff-header">
                      <div className="code-diff-toggle" onClick={() => setFileExpanded1(!fileExpanded1)} style={{ cursor: 'pointer' }}>
                        <svg
                          width="16"
                          height="16"
                          viewBox="0 0 16 16"
                          fill="currentColor"
                          style={{
                            transform: fileExpanded1 ? 'rotate(0deg)' : 'rotate(-90deg)',
                            transition: 'transform 0.2s ease'
                          }}
                        >
                          <path d="M4 6l4 4 4-4" stroke="currentColor" strokeWidth="2" fill="none"/>
                        </svg>
                        <span className="code-file-path">github/actions/npm-setup/action.yml</span>
                        <button className="copy-button">
                          <svg width="14" height="14" viewBox="0 0 14 14" fill="currentColor">
                            <rect x="2" y="2" width="8" height="8" stroke="currentColor" strokeWidth="1.5" fill="none"/>
                            <rect x="4" y="4" width="8" height="8" stroke="currentColor" strokeWidth="1.5" fill="none"/>
                          </svg>
                        </button>
                      </div>
                      <div className="code-diff-stats">
                        <span className="additions">+22</span>
                        <span className="deletions">-0</span>
                        <span className="separator">•</span>
                        <span className="coverage-badge">
                          <CoverageIndicator percentage={86.7} size={14} />
                          Coverage: 86.7%
                        </span>
                        <span className="separator">•</span>
                        <span className="duplication">Duplications: 0.0%</span>
                        <span className="separator">•</span>
                        <span className="issues">Issues: 0</span>
                        <button
                          className="check-button"
                          onClick={() => {
                            setFileChecked1(!fileChecked1);
                            if (!fileChecked1) setFileExpanded1(false);
                          }}
                          style={{ color: fileChecked1 ? '#4CAF50' : 'var(--color-text-muted)' }}
                        >
                          <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <circle cx="8" cy="8" r="7" stroke="currentColor" strokeWidth="1.5" fill="none"/>
                            <path d="M5 8l2 2 4-4" stroke="currentColor" strokeWidth="2" fill="none"/>
                          </svg>
                        </button>
                      </div>
                    </div>

                    {fileExpanded1 && (
                    <div className="code-diff-content">
                      <table className="code-table">
                        <tbody>
                          <tr className="code-line added">
                            <td className="line-number" onClick={() => handleLineClick('file1-line1')}>1</td>
                            <td className="line-comment-toggle" onClick={() => handleLineClick('file1-line1')}>
                              <AddCommentButton />
                            </td>
                            <td className="line-sign">+</td>
                            <td className="line-content">
                              <span className="code-keyword">name:</span> NPM Setup
                            </td>
                          </tr>
                          {renderNewCommentInput('file1-line1')}
                          <tr className="code-line added">
                            <td className="line-number" onClick={() => handleLineClick('file1-line2')}>2</td>
                            <td className="line-comment-toggle" onClick={() => handleLineClick('file1-line2')}>
                              <AddCommentButton />
                            </td>
                            <td className="line-sign">+</td>
                            <td className="line-content">
                              <span className="code-keyword">description:</span> Action to configure NPM registry with Artifactory token from Vault
                            </td>
                          </tr>
                          {renderNewCommentInput('file1-line2')}
                          <tr className="code-line added">
                            <td className="line-number" onClick={() => handleLineClick('file1-line3')}>3</td>
                            <td className="line-comment-toggle" onClick={() => handleLineClick('file1-line3')}>
                              <AddCommentButton />
                            </td>
                            <td className="line-sign">+</td>
                            <td className="line-content"></td>
                          </tr>
                          {renderNewCommentInput('file1-line3')}
                          <tr className="code-line added has-comment">
                            <td className="line-number" onClick={() => handleLineClick('file1-line4')}>4</td>
                            <td className="line-comment-toggle" onClick={() => handleLineClick('file1-line4')}>
                              <AddCommentButton />
                            </td>
                            <td className="line-sign">+</td>
                            <td className="line-content">
                              <span className="code-keyword">runs:</span>
                            </td>
                          </tr>
                          {renderNewCommentInput('file1-line4')}
                          <tr className="inline-comment-row">
                            <td className="line-number"></td>
                            <td className="line-comment-toggle"></td>
                            <td colSpan={2}>
                              <div className="inline-comment-container">
                                <div className="inline-comment">
                                  <div className="inline-comment-avatar">F</div>
                                  <div className="inline-comment-content">
                                    <div className="inline-comment-header">
                                      <span className="inline-comment-author">Frieda Handoko</span>
                                      <span className="inline-comment-date">22/12/2025, 03:30</span>
                                    </div>
                                    <p className="inline-comment-text">
                                      This line probably only makes sense if it goes to line 55
                                    </p>
                                    <div className="inline-comment-actions">
                                      <button className="inline-comment-action">Reply</button>
                                      <button className="inline-comment-action">Resolve</button>
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </td>
                          </tr>
                          <tr className="code-line added">
                            <td className="line-number" onClick={() => handleLineClick('file1-line5')}>5</td>
                            <td className="line-comment-toggle" onClick={() => handleLineClick('file1-line5')}>
                              <AddCommentButton />
                            </td>
                            <td className="line-sign">+</td>
                            <td className="line-content">
                              <span className="code-indent">  </span><span className="code-keyword">using:</span> <span className="code-string">"composite"</span>
                            </td>
                          </tr>
                          {renderNewCommentInput('file1-line5')}
                          <tr className="code-line added">
                            <td className="line-number" onClick={() => handleLineClick('file1-line6')}>6</td>
                            <td className="line-comment-toggle" onClick={() => handleLineClick('file1-line6')}>
                              <AddCommentButton />
                            </td>
                            <td className="line-sign">+</td>
                            <td className="line-content">
                              <span className="code-indent">  </span><span className="code-keyword">steps:</span>
                            </td>
                          </tr>
                          {renderNewCommentInput('file1-line6')}
                          <tr className="code-line added">
                            <td className="line-number" onClick={() => handleLineClick('file1-line7')}>7</td>
                            <td className="line-comment-toggle" onClick={() => handleLineClick('file1-line7')}>
                              <AddCommentButton />
                            </td>
                            <td className="line-sign">+</td>
                            <td className="line-content">
                              <span className="code-indent">    </span>- <span className="code-keyword">name:</span> Get vault secrets
                            </td>
                          </tr>
                          {renderNewCommentInput('file1-line7')}
                        </tbody>
                      </table>
                    </div>
                    )}
                  </div>

                  {/* Code Diff - Second File */}
                  <div className="code-diff-container">
                    <div className="code-diff-header">
                      <div className="code-diff-toggle" onClick={() => setFileExpanded2(!fileExpanded2)} style={{ cursor: 'pointer' }}>
                        <svg
                          width="16"
                          height="16"
                          viewBox="0 0 16 16"
                          fill="currentColor"
                          style={{
                            transform: fileExpanded2 ? 'rotate(0deg)' : 'rotate(-90deg)',
                            transition: 'transform 0.2s ease'
                          }}
                        >
                          <path d="M4 6l4 4 4-4" stroke="currentColor" strokeWidth="2" fill="none"/>
                        </svg>
                        <span className="code-file-path">.github/workflows/build.yml</span>
                        <button className="copy-button">
                          <svg width="14" height="14" viewBox="0 0 14 14" fill="currentColor">
                            <rect x="2" y="2" width="8" height="8" stroke="currentColor" strokeWidth="1.5" fill="none"/>
                            <rect x="4" y="4" width="8" height="8" stroke="currentColor" strokeWidth="1.5" fill="none"/>
                          </svg>
                        </button>
                      </div>
                      <div className="code-diff-stats">
                        <span className="additions">+2</span>
                        <span className="deletions">-7</span>
                        <span className="separator">•</span>
                        <span className="coverage-badge">
                          <CoverageIndicator percentage={65} size={14} />
                          Coverage: 65.0%
                        </span>
                        <span className="separator">•</span>
                        <span className="duplication">Duplications: 0.0%</span>
                        <span className="separator">•</span>
                        <span className="issues">Issues: 0</span>
                        <button
                          className="check-button"
                          onClick={() => {
                            setFileChecked2(!fileChecked2);
                            if (!fileChecked2) setFileExpanded2(false);
                          }}
                          style={{ color: fileChecked2 ? '#4CAF50' : 'var(--color-text-muted)' }}
                        >
                          <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <circle cx="8" cy="8" r="7" stroke="currentColor" strokeWidth="1.5" fill="none"/>
                            <path d="M5 8l2 2 4-4" stroke="currentColor" strokeWidth="2" fill="none"/>
                          </svg>
                        </button>
                      </div>
                    </div>

                    {fileExpanded2 && (
                    <div className="code-diff-content">
                      <table className="code-table">
                        <tbody>
                          <tr className="code-line">
                            <td className="line-number" onClick={() => handleLineClick('file1-line8')}>18</td>
                            <td className="line-comment-toggle" onClick={() => handleLineClick('file1-line8')}>
                              <AddCommentButton />
                            </td>
                            <td className="line-sign"></td>
                            <td className="line-content">
                              <span className="code-indent">  </span><span className="code-keyword">steps:</span>
                            </td>
                          </tr>
                          {renderNewCommentInput('file1-line8')}
                          <tr className="code-line removed">
                            <td className="line-number" onClick={() => handleLineClick('file1-line9')}>19</td>
                            <td className="line-comment-toggle" onClick={() => handleLineClick('file1-line9')}>
                              <AddCommentButton />
                            </td>
                            <td className="line-sign">-</td>
                            <td className="line-content">
                              <span className="code-indent">    </span>- <span className="code-keyword">name:</span> Setup Node.js
                            </td>
                          </tr>
                          {renderNewCommentInput('file1-line9')}
                          <tr className="code-line removed">
                            <td className="line-number" onClick={() => handleLineClick('file1-line10')}>20</td>
                            <td className="line-comment-toggle" onClick={() => handleLineClick('file1-line10')}>
                              <AddCommentButton />
                            </td>
                            <td className="line-sign">-</td>
                            <td className="line-content">
                              <span className="code-indent">      </span><span className="code-keyword">uses:</span> actions/setup-node@v3
                            </td>
                          </tr>
                          {renderNewCommentInput('file1-line10')}
                          <tr className="code-line removed">
                            <td className="line-number" onClick={() => handleLineClick('file1-line11')}>21</td>
                            <td className="line-comment-toggle" onClick={() => handleLineClick('file1-line11')}>
                              <AddCommentButton />
                            </td>
                            <td className="line-sign">-</td>
                            <td className="line-content">
                              <span className="code-indent">      </span><span className="code-keyword">with:</span>
                            </td>
                          </tr>
                          {renderNewCommentInput('file1-line11')}
                          <tr className="code-line removed">
                            <td className="line-number" onClick={() => handleLineClick('file1-line12')}>22</td>
                            <td className="line-comment-toggle" onClick={() => handleLineClick('file1-line12')}>
                              <AddCommentButton />
                            </td>
                            <td className="line-sign">-</td>
                            <td className="line-content">
                              <span className="code-indent">        </span><span className="code-keyword">node-version:</span> <span className="code-string">'18'</span>
                            </td>
                          </tr>
                          {renderNewCommentInput('file1-line12')}
                          <tr className="code-line removed">
                            <td className="line-number" onClick={() => handleLineClick('file1-line13')}>23</td>
                            <td className="line-comment-toggle" onClick={() => handleLineClick('file1-line13')}>
                              <AddCommentButton />
                            </td>
                            <td className="line-sign">-</td>
                            <td className="line-content">
                              <span className="code-indent">        </span><span className="code-keyword">cache:</span> <span className="code-string">'npm'</span>
                            </td>
                          </tr>
                          {renderNewCommentInput('file1-line13')}
                          <tr className="code-line removed">
                            <td className="line-number" onClick={() => handleLineClick('file1-line14')}>24</td>
                            <td className="line-comment-toggle" onClick={() => handleLineClick('file1-line14')}>
                              <AddCommentButton />
                            </td>
                            <td className="line-sign">-</td>
                            <td className="line-content"></td>
                          </tr>
                          {renderNewCommentInput('file1-line14')}
                          <tr className="code-line removed">
                            <td className="line-number" onClick={() => handleLineClick('file1-line15')}>25</td>
                            <td className="line-comment-toggle" onClick={() => handleLineClick('file1-line15')}>
                              <AddCommentButton />
                            </td>
                            <td className="line-sign">-</td>
                            <td className="line-content">
                              <span className="code-indent">    </span>- <span className="code-keyword">name:</span> Install dependencies
                            </td>
                          </tr>
                          {renderNewCommentInput('file1-line15')}
                          <tr className="code-line added">
                            <td className="line-number" onClick={() => handleLineClick('file1-line16')}>19</td>
                            <td className="line-comment-toggle" onClick={() => handleLineClick('file1-line16')}>
                              <AddCommentButton />
                            </td>
                            <td className="line-sign">+</td>
                            <td className="line-content">
                              <span className="code-indent">    </span>- <span className="code-keyword">name:</span> Setup NPM
                            </td>
                          </tr>
                          {renderNewCommentInput('file1-line16')}
                          <tr className="code-line added">
                            <td className="line-number" onClick={() => handleLineClick('file1-line17')}>20</td>
                            <td className="line-comment-toggle" onClick={() => handleLineClick('file1-line17')}>
                              <AddCommentButton />
                            </td>
                            <td className="line-sign">+</td>
                            <td className="line-content">
                              <span className="code-indent">      </span><span className="code-keyword">uses:</span> ./github/actions/npm-setup
                            </td>
                          </tr>
                          {renderNewCommentInput('file1-line17')}
                          <tr className="code-line">
                            <td className="line-number" onClick={() => handleLineClick('file1-line18')}>21</td>
                            <td className="line-comment-toggle" onClick={() => handleLineClick('file1-line18')}>
                              <AddCommentButton />
                            </td>
                            <td className="line-sign"></td>
                            <td className="line-content"></td>
                          </tr>
                          {renderNewCommentInput('file1-line18')}
                          <tr className="code-line">
                            <td className="line-number" onClick={() => handleLineClick('file1-line19')}>22</td>
                            <td className="line-comment-toggle" onClick={() => handleLineClick('file1-line19')}>
                              <AddCommentButton />
                            </td>
                            <td className="line-sign"></td>
                            <td className="line-content">
                              <span className="code-indent">    </span>- <span className="code-keyword">name:</span> Run build
                            </td>
                          </tr>
                          {renderNewCommentInput('file1-line19')}
                        </tbody>
                      </table>
                    </div>
                    )}
                  </div>

                  {/* Code Diff - Third File */}
                  <div className="code-diff-container">
                    <div className="code-diff-header">
                      <div className="code-diff-toggle" onClick={() => setFileExpanded3(!fileExpanded3)} style={{ cursor: 'pointer' }}>
                        <svg
                          width="16"
                          height="16"
                          viewBox="0 0 16 16"
                          fill="currentColor"
                          style={{
                            transform: fileExpanded3 ? 'rotate(0deg)' : 'rotate(-90deg)',
                            transition: 'transform 0.2s ease'
                          }}
                        >
                          <path d="M4 6l4 4 4-4" stroke="currentColor" strokeWidth="2" fill="none"/>
                        </svg>
                        <span className="code-file-path">.github/workflows/deploy.yml</span>
                        <button className="copy-button">
                          <svg width="14" height="14" viewBox="0 0 14 14" fill="currentColor">
                            <rect x="2" y="2" width="8" height="8" stroke="currentColor" strokeWidth="1.5" fill="none"/>
                            <rect x="4" y="4" width="8" height="8" stroke="currentColor" strokeWidth="1.5" fill="none"/>
                          </svg>
                        </button>
                      </div>
                      <div className="code-diff-stats">
                        <span className="additions">+1</span>
                        <span className="deletions">-2</span>
                        <span className="separator">•</span>
                        <span className="coverage-badge">
                          <CoverageIndicator percentage={45} size={14} />
                          Coverage: 45.0%
                        </span>
                        <span className="separator">•</span>
                        <span className="duplication">Duplications: 0.0%</span>
                        <span className="separator">•</span>
                        <span className="issues">Issues: 0</span>
                        <button
                          className="check-button"
                          onClick={() => {
                            setFileChecked3(!fileChecked3);
                            if (!fileChecked3) setFileExpanded3(false);
                          }}
                          style={{ color: fileChecked3 ? '#4CAF50' : 'var(--color-text-muted)' }}
                        >
                          <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <circle cx="8" cy="8" r="7" stroke="currentColor" strokeWidth="1.5" fill="none"/>
                            <path d="M5 8l2 2 4-4" stroke="currentColor" strokeWidth="2" fill="none"/>
                          </svg>
                        </button>
                      </div>
                    </div>

                    {fileExpanded3 && (
                    <div className="code-diff-content">
                      <table className="code-table">
                        <tbody>
                          <tr className="code-line">
                            <td className="line-number" onClick={() => handleLineClick('file1-line20')}>32</td>
                            <td className="line-comment-toggle" onClick={() => handleLineClick('file1-line20')}>
                              <AddCommentButton />
                            </td>
                            <td className="line-sign"></td>
                            <td className="line-content">
                              <span className="code-indent">  </span><span className="code-keyword">steps:</span>
                            </td>
                          </tr>
                          {renderNewCommentInput('file1-line20')}
                          <tr className="code-line removed">
                            <td className="line-number" onClick={() => handleLineClick('file1-line21')}>33</td>
                            <td className="line-comment-toggle" onClick={() => handleLineClick('file1-line21')}>
                              <AddCommentButton />
                            </td>
                            <td className="line-sign">-</td>
                            <td className="line-content">
                              <span className="code-indent">    </span>- <span className="code-keyword">uses:</span> actions/setup-node@v3
                            </td>
                          </tr>
                          {renderNewCommentInput('file1-line21')}
                          <tr className="code-line removed">
                            <td className="line-number" onClick={() => handleLineClick('file1-line22')}>34</td>
                            <td className="line-comment-toggle" onClick={() => handleLineClick('file1-line22')}>
                              <AddCommentButton />
                            </td>
                            <td className="line-sign">-</td>
                            <td className="line-content">
                              <span className="code-indent">      </span><span className="code-keyword">with:</span>
                            </td>
                          </tr>
                          {renderNewCommentInput('file1-line22')}
                          <tr className="code-line added">
                            <td className="line-number" onClick={() => handleLineClick('file1-line23')}>33</td>
                            <td className="line-comment-toggle" onClick={() => handleLineClick('file1-line23')}>
                              <AddCommentButton />
                            </td>
                            <td className="line-sign">+</td>
                            <td className="line-content">
                              <span className="code-indent">    </span>- <span className="code-keyword">uses:</span> ./github/actions/npm-setup
                            </td>
                          </tr>
                          {renderNewCommentInput('file1-line23')}
                          <tr className="code-line">
                            <td className="line-number" onClick={() => handleLineClick('file1-line24')}>34</td>
                            <td className="line-comment-toggle" onClick={() => handleLineClick('file1-line24')}>
                              <AddCommentButton />
                            </td>
                            <td className="line-sign"></td>
                            <td className="line-content"></td>
                          </tr>
                          {renderNewCommentInput('file1-line24')}
                          <tr className="code-line">
                            <td className="line-number" onClick={() => handleLineClick('file1-line25')}>35</td>
                            <td className="line-comment-toggle" onClick={() => handleLineClick('file1-line25')}>
                              <AddCommentButton />
                            </td>
                            <td className="line-sign"></td>
                            <td className="line-content">
                              <span className="code-indent">    </span>- <span className="code-keyword">name:</span> Deploy to production
                            </td>
                          </tr>
                          {renderNewCommentInput('file1-line25')}
                        </tbody>
                      </table>
                    </div>
                    )}
                  </div>

                  {/* Mark as reviewed button */}
                  <div style={{ display: 'flex', justifyContent: 'flex-end', marginTop: '16px' }}>
                    <button
                      className={groupReviewed1 ? "mark-needs-review-button" : "mark-reviewed-button"}
                      onClick={() => {
                        if (!groupReviewed1) {
                          // Mark as reviewed
                          setFileChecked1(true);
                          setFileChecked2(true);
                          setFileChecked3(true);
                          setFileExpanded1(false);
                          setFileExpanded2(false);
                          setFileExpanded3(false);
                          setGroupReviewed1(true);
                          setShowFileChanges(false); // Collapse the group
                        } else {
                          // Mark as needs review
                          setFileChecked1(false);
                          setFileChecked2(false);
                          setFileChecked3(false);
                          setGroupReviewed1(false);
                        }
                      }}
                    >
                      {groupReviewed1 ? 'Mark as needs review' : 'Mark as reviewed'}
                    </button>
                  </div>
                    </>
                  )}
                </div>

                {/* Second File Change Card - API Authentication Updates */}
                <div className="file-change-card">
                  <div className="file-change-header" style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between' }}>
                    <div style={{ display: 'flex', alignItems: 'center', gap: '12px', flex: 1 }}>
                      <h3 style={{ margin: 0 }}>API Authentication & Security Enhancements</h3>
                      <span className="needs-review-badge">Needs review</span>
                      <div className="file-change-meta" style={{ display: 'flex', alignItems: 'center', gap: '8px', marginLeft: 'auto' }}>
                        <span className="file-count">2 files</span>
                        <span className="additions">+47</span>
                        <span className="deletions">-12</span>
                      </div>
                    </div>
                    <button
                      className="pin-button"
                      onClick={() => setShowFileChanges2(!showFileChanges2)}
                      style={{ marginLeft: '12px' }}
                    >
                      <svg
                        width="16"
                        height="16"
                        viewBox="0 0 16 16"
                        fill="currentColor"
                        style={{
                          transform: showFileChanges2 ? 'rotate(0deg)' : 'rotate(-90deg)',
                          transition: 'transform 0.2s'
                        }}
                      >
                        <path d="M4 6l4 4 4-4" stroke="currentColor" strokeWidth="2" fill="none"/>
                      </svg>
                    </button>
                  </div>

                  {showFileChanges2 && (
                    <>
                      <div className="file-change-description">
                        <p>Enhanced API authentication with JWT token refresh mechanism and improved error handling for expired tokens.</p>
                        <p className="review-focus"><strong>Review Focus:</strong> Verify the token refresh logic handles edge cases properly, check that error messages don't leak sensitive information, and ensure the new middleware is correctly integrated.</p>
                      </div>

                      {/* Code Diff 1 */}
                      <div className="code-diff-container">
                        <div className="code-diff-header">
                          <div className="code-diff-toggle" onClick={() => setFileExpanded4(!fileExpanded4)} style={{ cursor: 'pointer' }}>
                            <svg
                              width="16"
                              height="16"
                              viewBox="0 0 16 16"
                              fill="currentColor"
                              style={{
                                transform: fileExpanded4 ? 'rotate(0deg)' : 'rotate(-90deg)',
                                transition: 'transform 0.2s ease'
                              }}
                            >
                              <path d="M4 6l4 4 4-4" stroke="currentColor" strokeWidth="2" fill="none"/>
                            </svg>
                            <span className="code-file-path">src/middleware/auth.ts</span>
                            <button className="copy-button">
                              <svg width="14" height="14" viewBox="0 0 14 14" fill="currentColor">
                                <rect x="2" y="2" width="8" height="8" stroke="currentColor" strokeWidth="1.5" fill="none"/>
                                <rect x="4" y="4" width="8" height="8" stroke="currentColor" strokeWidth="1.5" fill="none"/>
                              </svg>
                            </button>
                          </div>
                          <div className="code-diff-stats">
                            <span className="additions">+35</span>
                            <span className="deletions">-8</span>
                            <span className="separator">•</span>
                            <span className="coverage-badge">
                              <CoverageIndicator percentage={92} size={14} />
                              Coverage: 92.0%
                            </span>
                            <span className="separator">•</span>
                            <span className="duplication">Duplications: 0.0%</span>
                            <span className="separator">•</span>
                            <span className="issues">Issues: 0</span>
                            <button
                              className="check-button"
                              onClick={() => {
                                setFileChecked4(!fileChecked4);
                                if (!fileChecked4) setFileExpanded4(false);
                              }}
                              style={{ color: fileChecked4 ? '#4CAF50' : 'var(--color-text-muted)' }}
                            >
                              <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                <circle cx="8" cy="8" r="7" stroke="currentColor" strokeWidth="1.5" fill="none"/>
                                <path d="M5 8l2 2 4-4" stroke="currentColor" strokeWidth="2" fill="none"/>
                              </svg>
                            </button>
                          </div>
                        </div>

                        {fileExpanded4 && (
                        <div className="code-diff-content">
                          <table className="code-table">
                            <tbody>
                              <tr className="code-line">
                                <td className="line-number">15</td>
                                <td className="line-comment-toggle">
                                  <AddCommentButton />
                                </td>
                                <td className="line-sign"></td>
                                <td className="line-content">
                                  <span className="code-keyword">export</span> <span className="code-keyword">async function</span> verifyToken(token: <span className="code-keyword">string</span>) {'{'}
                                </td>
                              </tr>
                              <tr className="code-line removed">
                                <td className="line-number">16</td>
                                <td className="line-comment-toggle">
                                  <AddCommentButton />
                                </td>
                                <td className="line-sign">-</td>
                                <td className="line-content">
                                  <span className="code-indent">  </span><span className="code-keyword">return</span> jwt.verify(token, SECRET_KEY);
                                </td>
                              </tr>
                              <tr className="code-line added">
                                <td className="line-number">17</td>
                                <td className="line-comment-toggle">
                                  <AddCommentButton />
                                </td>
                                <td className="line-sign">+</td>
                                <td className="line-content">
                                  <span className="code-indent">  </span><span className="code-keyword">try</span> {'{'}
                                </td>
                              </tr>
                              <tr className="code-line added">
                                <td className="line-number">18</td>
                                <td className="line-comment-toggle">
                                  <AddCommentButton />
                                </td>
                                <td className="line-sign">+</td>
                                <td className="line-content">
                                  <span className="code-indent">    </span><span className="code-keyword">const</span> decoded = <span className="code-keyword">await</span> jwt.verify(token, SECRET_KEY);
                                </td>
                              </tr>
                              <tr className="code-line added">
                                <td className="line-number">19</td>
                                <td className="line-comment-toggle">
                                  <AddCommentButton />
                                </td>
                                <td className="line-sign">+</td>
                                <td className="line-content">
                                  <span className="code-indent">    </span><span className="code-keyword">return</span> {'{'} valid: <span className="code-keyword">true</span>, data: decoded {'}'};
                                </td>
                              </tr>
                              <tr className="code-line added">
                                <td className="line-number">20</td>
                                <td className="line-comment-toggle">
                                  <AddCommentButton />
                                </td>
                                <td className="line-sign">+</td>
                                <td className="line-content">
                                  <span className="code-indent">  </span>{'}'} <span className="code-keyword">catch</span> (error) {'{'}
                                </td>
                              </tr>
                              <tr className="code-line added">
                                <td className="line-number">21</td>
                                <td className="line-comment-toggle">
                                  <AddCommentButton />
                                </td>
                                <td className="line-sign">+</td>
                                <td className="line-content">
                                  <span className="code-indent">    </span><span className="code-keyword">return</span> {'{'} valid: <span className="code-keyword">false</span>, error: <span className="code-string">'Invalid or expired token'</span> {'}'};
                                </td>
                              </tr>
                              <tr className="code-line added">
                                <td className="line-number">22</td>
                                <td className="line-comment-toggle">
                                  <AddCommentButton />
                                </td>
                                <td className="line-sign">+</td>
                                <td className="line-content">
                                  <span className="code-indent">  </span>{'}'}
                                </td>
                              </tr>
                              <tr className="code-line">
                                <td className="line-number">23</td>
                                <td className="line-comment-toggle">
                                  <AddCommentButton />
                                </td>
                                <td className="line-sign"></td>
                                <td className="line-content">
                                  {'}'}
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </div>
                        )}
                      </div>

                      {/* Code Diff 2 */}
                      <div className="code-diff-container">
                        <div className="code-diff-header">
                          <div className="code-diff-toggle" onClick={() => setFileExpanded5(!fileExpanded5)} style={{ cursor: 'pointer' }}>
                            <svg
                              width="16"
                              height="16"
                              viewBox="0 0 16 16"
                              fill="currentColor"
                              style={{
                                transform: fileExpanded5 ? 'rotate(0deg)' : 'rotate(-90deg)',
                                transition: 'transform 0.2s ease'
                              }}
                            >
                              <path d="M4 6l4 4 4-4" stroke="currentColor" strokeWidth="2" fill="none"/>
                            </svg>
                            <span className="code-file-path">src/api/refresh-token.ts</span>
                            <button className="copy-button">
                              <svg width="14" height="14" viewBox="0 0 14 14" fill="currentColor">
                                <rect x="2" y="2" width="8" height="8" stroke="currentColor" strokeWidth="1.5" fill="none"/>
                                <rect x="4" y="4" width="8" height="8" stroke="currentColor" strokeWidth="1.5" fill="none"/>
                              </svg>
                            </button>
                          </div>
                          <div className="code-diff-stats">
                            <span className="additions">+12</span>
                            <span className="deletions">-4</span>
                            <span className="separator">•</span>
                            <span className="coverage-badge">
                              <CoverageIndicator percentage={78} size={14} />
                              Coverage: 78.0%
                            </span>
                            <span className="separator">•</span>
                            <span className="duplication">Duplications: 0.0%</span>
                            <span className="separator">•</span>
                            <span className="issues">Issues: 1</span>
                            <button
                              className="check-button"
                              onClick={() => {
                                setFileChecked5(!fileChecked5);
                                if (!fileChecked5) setFileExpanded5(false);
                              }}
                              style={{ color: fileChecked5 ? '#4CAF50' : 'var(--color-text-muted)' }}
                            >
                              <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                <circle cx="8" cy="8" r="7" stroke="currentColor" strokeWidth="1.5" fill="none"/>
                                <path d="M5 8l2 2 4-4" stroke="currentColor" strokeWidth="2" fill="none"/>
                              </svg>
                            </button>
                          </div>
                        </div>

                        {fileExpanded5 && (
                        <div className="code-diff-content">
                          <table className="code-table">
                            <tbody>
                              <tr className="code-line added">
                                <td className="line-number">1</td>
                                <td className="line-comment-toggle">
                                  <AddCommentButton />
                                </td>
                                <td className="line-sign">+</td>
                                <td className="line-content">
                                  <span className="code-keyword">import</span> {'{'} generateToken {'}'} <span className="code-keyword">from</span> <span className="code-string">'./auth'</span>;
                                </td>
                              </tr>
                              <tr className="code-line added">
                                <td className="line-number">2</td>
                                <td className="line-comment-toggle">
                                  <AddCommentButton />
                                </td>
                                <td className="line-sign">+</td>
                                <td className="line-content">
                                  <span className="code-keyword">import</span> {'{'} validateRefreshToken {'}'} <span className="code-keyword">from</span> <span className="code-string">'./utils'</span>;
                                </td>
                              </tr>
                              <tr className="code-line">
                                <td className="line-number">3</td>
                                <td className="line-comment-toggle">
                                  <AddCommentButton />
                                </td>
                                <td className="line-sign"></td>
                                <td className="line-content"></td>
                              </tr>
                              <tr className="code-line added">
                                <td className="line-number">4</td>
                                <td className="line-comment-toggle">
                                  <AddCommentButton />
                                </td>
                                <td className="line-sign">+</td>
                                <td className="line-content">
                                  <span className="code-keyword">export async function</span> refreshAccessToken(refreshToken: <span className="code-keyword">string</span>) {'{'}
                                </td>
                              </tr>
                              <tr className="code-line added">
                                <td className="line-number">5</td>
                                <td className="line-comment-toggle">
                                  <AddCommentButton />
                                </td>
                                <td className="line-sign">+</td>
                                <td className="line-content">
                                  <span className="code-indent">  </span><span className="code-keyword">const</span> isValid = <span className="code-keyword">await</span> validateRefreshToken(refreshToken);
                                </td>
                              </tr>
                              <tr className="code-line added">
                                <td className="line-number">6</td>
                                <td className="line-comment-toggle">
                                  <AddCommentButton />
                                </td>
                                <td className="line-sign">+</td>
                                <td className="line-content">
                                  <span className="code-indent">  </span><span className="code-keyword">if</span> (!isValid) <span className="code-keyword">throw new</span> Error(<span className="code-string">'Invalid refresh token'</span>);
                                </td>
                              </tr>
                              <tr className="code-line added">
                                <td className="line-number">7</td>
                                <td className="line-comment-toggle">
                                  <AddCommentButton />
                                </td>
                                <td className="line-sign">+</td>
                                <td className="line-content">
                                  <span className="code-indent">  </span><span className="code-keyword">return</span> generateToken(isValid.userId);
                                </td>
                              </tr>
                              <tr className="code-line added">
                                <td className="line-number">8</td>
                                <td className="line-comment-toggle">
                                  <AddCommentButton />
                                </td>
                                <td className="line-sign">+</td>
                                <td className="line-content">
                                  {'}'}
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </div>
                        )}
                      </div>

                      {/* Mark as reviewed button */}
                      <div style={{ display: 'flex', justifyContent: 'flex-end', marginTop: '16px' }}>
                        <button
                          className={groupReviewed2 ? "mark-needs-review-button" : "mark-reviewed-button"}
                          onClick={() => {
                            if (!groupReviewed2) {
                              // Mark as reviewed
                              setFileChecked4(true);
                              setFileChecked5(true);
                              setFileExpanded4(false);
                              setFileExpanded5(false);
                              setGroupReviewed2(true);
                              setShowFileChanges2(false); // Collapse the group
                            } else {
                              // Mark as needs review
                              setFileChecked4(false);
                              setFileChecked5(false);
                              setGroupReviewed2(false);
                            }
                          }}
                        >
                          {groupReviewed2 ? 'Mark as needs review' : 'Mark as reviewed'}
                        </button>
                      </div>
                    </>
                  )}
                </div>

                {/* Third File Change Card - Database Migration Scripts */}
                <div className="file-change-card">
                  <div className="file-change-header" style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between' }}>
                    <div style={{ display: 'flex', alignItems: 'center', gap: '12px', flex: 1 }}>
                      <h3 style={{ margin: 0 }}>Database Schema Migration - User Preferences</h3>
                      <span className="needs-review-badge">Needs review</span>
                      <div className="file-change-meta" style={{ display: 'flex', alignItems: 'center', gap: '8px', marginLeft: 'auto' }}>
                        <span className="file-count">1 file</span>
                        <span className="additions">+28</span>
                        <span className="deletions">-0</span>
                      </div>
                    </div>
                    <button
                      className="pin-button"
                      onClick={() => setShowFileChanges3(!showFileChanges3)}
                      style={{ marginLeft: '12px' }}
                    >
                      <svg
                        width="16"
                        height="16"
                        viewBox="0 0 16 16"
                        fill="currentColor"
                        style={{
                          transform: showFileChanges3 ? 'rotate(0deg)' : 'rotate(-90deg)',
                          transition: 'transform 0.2s'
                        }}
                      >
                        <path d="M4 6l4 4 4-4" stroke="currentColor" strokeWidth="2" fill="none"/>
                      </svg>
                    </button>
                  </div>

                  {showFileChanges3 && (
                    <>
                      <div className="file-change-description">
                        <p>Added new database migration to create user_preferences table for storing theme, language, and notification settings.</p>
                        <p className="review-focus"><strong>Review Focus:</strong> Verify the migration script includes proper indexes for frequently queried columns, check foreign key constraints are correctly defined, and ensure the rollback script is complete.</p>
                      </div>

                      {/* Code Diff */}
                      <div className="code-diff-container">
                        <div className="code-diff-header">
                          <div className="code-diff-toggle" onClick={() => setFileExpanded6(!fileExpanded6)} style={{ cursor: 'pointer' }}>
                            <svg
                              width="16"
                              height="16"
                              viewBox="0 0 16 16"
                              fill="currentColor"
                              style={{
                                transform: fileExpanded6 ? 'rotate(0deg)' : 'rotate(-90deg)',
                                transition: 'transform 0.2s ease'
                              }}
                            >
                              <path d="M4 6l4 4 4-4" stroke="currentColor" strokeWidth="2" fill="none"/>
                            </svg>
                            <span className="code-file-path">migrations/20260119_add_user_preferences.sql</span>
                            <button className="copy-button">
                              <svg width="14" height="14" viewBox="0 0 14 14" fill="currentColor">
                                <rect x="2" y="2" width="8" height="8" stroke="currentColor" strokeWidth="1.5" fill="none"/>
                                <rect x="4" y="4" width="8" height="8" stroke="currentColor" strokeWidth="1.5" fill="none"/>
                              </svg>
                            </button>
                          </div>
                          <div className="code-diff-stats">
                            <span className="additions">+28</span>
                            <span className="deletions">-0</span>
                            <span className="separator">•</span>
                            <span className="coverage-badge">
                              <CoverageIndicator percentage={0} size={14} />
                              Coverage: 0.0%
                            </span>
                            <span className="separator">•</span>
                            <span className="duplication">Duplications: 0.0%</span>
                            <span className="separator">•</span>
                            <span className="issues">Issues: 0</span>
                            <button
                              className="check-button"
                              onClick={() => {
                                setFileChecked6(!fileChecked6);
                                if (!fileChecked6) setFileExpanded6(false);
                              }}
                              style={{ color: fileChecked6 ? '#4CAF50' : 'var(--color-text-muted)' }}
                            >
                              <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                <circle cx="8" cy="8" r="7" stroke="currentColor" strokeWidth="1.5" fill="none"/>
                                <path d="M5 8l2 2 4-4" stroke="currentColor" strokeWidth="2" fill="none"/>
                              </svg>
                            </button>
                          </div>
                        </div>

                        {fileExpanded6 && (

                        <div className="code-diff-content">
                          <table className="code-table">
                            <tbody>
                              <tr className="code-line added">
                                <td className="line-number">1</td>
                                <td className="line-comment-toggle">
                                  <AddCommentButton />
                                </td>
                                <td className="line-sign">+</td>
                                <td className="line-content">
                                  <span className="code-keyword">CREATE TABLE</span> user_preferences (
                                </td>
                              </tr>
                              <tr className="code-line added">
                                <td className="line-number">2</td>
                                <td className="line-comment-toggle">
                                  <AddCommentButton />
                                </td>
                                <td className="line-sign">+</td>
                                <td className="line-content">
                                  <span className="code-indent">  </span>id <span className="code-keyword">BIGSERIAL PRIMARY KEY</span>,
                                </td>
                              </tr>
                              <tr className="code-line added">
                                <td className="line-number">3</td>
                                <td className="line-comment-toggle">
                                  <AddCommentButton />
                                </td>
                                <td className="line-sign">+</td>
                                <td className="line-content">
                                  <span className="code-indent">  </span>user_id <span className="code-keyword">BIGINT NOT NULL</span>,
                                </td>
                              </tr>
                              <tr className="code-line added">
                                <td className="line-number">4</td>
                                <td className="line-comment-toggle">
                                  <AddCommentButton />
                                </td>
                                <td className="line-sign">+</td>
                                <td className="line-content">
                                  <span className="code-indent">  </span>theme <span className="code-keyword">VARCHAR</span>(20) <span className="code-keyword">DEFAULT</span> <span className="code-string">'light'</span>,
                                </td>
                              </tr>
                              <tr className="code-line added">
                                <td className="line-number">5</td>
                                <td className="line-comment-toggle">
                                  <AddCommentButton />
                                </td>
                                <td className="line-sign">+</td>
                                <td className="line-content">
                                  <span className="code-indent">  </span>language <span className="code-keyword">VARCHAR</span>(10) <span className="code-keyword">DEFAULT</span> <span className="code-string">'en'</span>,
                                </td>
                              </tr>
                              <tr className="code-line added">
                                <td className="line-number">6</td>
                                <td className="line-comment-toggle">
                                  <AddCommentButton />
                                </td>
                                <td className="line-sign">+</td>
                                <td className="line-content">
                                  <span className="code-indent">  </span>notifications_enabled <span className="code-keyword">BOOLEAN DEFAULT TRUE</span>,
                                </td>
                              </tr>
                              <tr className="code-line added">
                                <td className="line-number">7</td>
                                <td className="line-comment-toggle">
                                  <AddCommentButton />
                                </td>
                                <td className="line-sign">+</td>
                                <td className="line-content">
                                  <span className="code-indent">  </span>created_at <span className="code-keyword">TIMESTAMP DEFAULT CURRENT_TIMESTAMP</span>,
                                </td>
                              </tr>
                              <tr className="code-line added">
                                <td className="line-number">8</td>
                                <td className="line-comment-toggle">
                                  <AddCommentButton />
                                </td>
                                <td className="line-sign">+</td>
                                <td className="line-content">
                                  <span className="code-indent">  </span>updated_at <span className="code-keyword">TIMESTAMP DEFAULT CURRENT_TIMESTAMP</span>,
                                </td>
                              </tr>
                              <tr className="code-line added">
                                <td className="line-number">9</td>
                                <td className="line-comment-toggle">
                                  <AddCommentButton />
                                </td>
                                <td className="line-sign">+</td>
                                <td className="line-content">
                                  <span className="code-indent">  </span><span className="code-keyword">FOREIGN KEY</span> (user_id) <span className="code-keyword">REFERENCES</span> users(id) <span className="code-keyword">ON DELETE CASCADE</span>
                                </td>
                              </tr>
                              <tr className="code-line added">
                                <td className="line-number">10</td>
                                <td className="line-comment-toggle">
                                  <AddCommentButton />
                                </td>
                                <td className="line-sign">+</td>
                                <td className="line-content">
                                  );
                                </td>
                              </tr>
                              <tr className="code-line">
                                <td className="line-number">11</td>
                                <td className="line-comment-toggle">
                                  <AddCommentButton />
                                </td>
                                <td className="line-sign"></td>
                                <td className="line-content"></td>
                              </tr>
                              <tr className="code-line added">
                                <td className="line-number">12</td>
                                <td className="line-comment-toggle">
                                  <AddCommentButton />
                                </td>
                                <td className="line-sign">+</td>
                                <td className="line-content">
                                  <span className="code-keyword">CREATE INDEX</span> idx_user_preferences_user_id <span className="code-keyword">ON</span> user_preferences(user_id);
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </div>
                        )}
                      </div>

                      {/* Mark as reviewed button */}
                      <div style={{ display: 'flex', justifyContent: 'flex-end', marginTop: '16px' }}>
                        <button
                          className={groupReviewed3 ? "mark-needs-review-button" : "mark-reviewed-button"}
                          onClick={() => {
                            if (!groupReviewed3) {
                              // Mark as reviewed
                              setFileChecked6(true);
                              setFileExpanded6(false);
                              setGroupReviewed3(true);
                              setShowFileChanges3(false); // Collapse the group
                            } else {
                              // Mark as needs review
                              setFileChecked6(false);
                              setGroupReviewed3(false);
                            }
                          }}
                        >
                          {groupReviewed3 ? 'Mark as needs review' : 'Mark as reviewed'}
                        </button>
                      </div>
                    </>
                  )}
                </div>
              </div>
            </div>
            </div>
          )}
        </main>
      </div>
    </div>
  );
}
